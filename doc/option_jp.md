こちらはHalfcliffのオプションの部品用の資料です。(2022/1/4時点では作成中の資料です。対応完了、と書かれたもの以外は使用不可です。)

対応を予定しているオプションの部品は以下の通りです。
設計時の制約によっては、対応を断念する可能性もあります。
* (対応完了。随時追記します)ロータリーエンコーダ
* (現状は左キーボードのみ動作確認済。資料作成完了。部品準備中)ビットトレードワン製トラックボール(ADTB7M)
* (条件付きで動作確認済。資料作成中)OLED
* (動作確認予定)BLE Micro Pro
* (設計予定)直交配列拡張基板
* (設計予定)英字配列風拡張基板


# ロータリーエンコーダ
基板のフットプリントに対応しているロータリーエンコーダが使用可能です。

実機にて動作確認済のものは以下の通りです。
* PEC12R-4222F-S0024(遊舎工房様等で購入可能)
* EC12E2430803(秋月電子様等で購入可能)

## 必要な部品の用意
以下の部品を用意します。

|名前|合計数|備考|
|:-|:-|:-|
|ロータリーエンコーダ|1個||
|ロータリーエンコーダ用ノブ|1個||

## 使用時の主な注意点
* 組立済みのキーボードにロータリーエンコーダを取付ける場合、取付け箇所のキースイッチを(はんだを除去して)取外す必要があります。
* ロータリーエンコーダのプッシュ機能は未対応です。
* ロータリーエンコーダ使用時は、対応するファームウェアの書込みが必要です。
* 操作時の動作を変更する際は、QMK MSYSまたはRemap、VIAを使用する必要があります。Remap、VIAを使用する場合、ロータリーエンコーダを上から見て時計回りに回転させた時の動作は、ロータリーエンコーダを取付けた列の一番上のキーと同じになります。
* (β版のみ)ロータリーエンコーダ取付け時に端子とトッププレートが干渉する場合、端子の位置や角度を干渉しないように調整するか、トッププレートの干渉部分を削る必要があります。

## 取付け方法

おおまかな作業順序
* (キースイッチはんだ付け済みの場合)ロータリーエンコーダ取付箇所のキースイッチの取外し
* ロータリーエンコーダの取付、はんだ付け(β版は注意点有り)
* (QMK Toolboxを使用する場合)ロータリーエンコーダ対応のファームウェアの書込み
* (QMK MSYSを使用する場合)ロータリーエンコーダ対応のファームウェアの書込み

## (キースイッチはんだ付け済みの場合)ロータリーエンコーダ取付箇所のキースイッチの取外し
ロータリーエンコーダ取付箇所(左右キーボード共に、一番内側の上から四番目のキーの位置)

にキースイッチがある場合は(はんだを除去して)取外します。ない場合はこの手順は飛ばします。

まずは取付を行うキーボードを裏返し、キースイッチ基板及び拡張基板をボトムプレートに固定しているねじを取外します。

左キーボードのねじ取外し箇所(黄丸で示したねじを取外します。右キーボードの場合も同じイメージです。)
![ねじ取外し_ロータリーエンコーダ取付時](https://user-images.githubusercontent.com/54104281/147803209-2badeb80-8cf0-4f1e-b8aa-3da6823bc07c.jpg)

ねじを取外したら、キースイッチ基板と拡張基板をProMicro基板の反対方向にスライドさせて取外します。この時、ProMicro基板とキースイッチ基板を接続しているピンになるべく負荷をかけないよう注意します。

左キーボードの取外しのイメージ(水色の矢印の向きにスライドさせます。右キーボードの場合は逆方向です。)

![キースイッチ基板取外し_ロータリーエンコーダ取付時](https://user-images.githubusercontent.com/54104281/147803508-5d07b866-d666-4027-957a-6e8e78c8a807.jpg)

取外し後、ロータリーエンコーダ取付箇所のキースイッチのはんだをはんだ吸取機等で取り除き、取外します。

左キーボードでの取外し箇所(画像の黄丸の部分のはんだを除去し、キースイッチを取外します。右キーボードの場合も、一番内側の上から四番目のキーのはんだを同じ様に除去します。)

![キースイッチ取外し箇所](https://user-images.githubusercontent.com/54104281/147863916-c1e1fa41-1d0b-49c7-9cdb-72b9cdd6c1cd.jpg)

## ロータリーエンコーダの取付、はんだ付け(β版の場合注意点有り)

ロータリーエンコーダを取付け、はんだ付けします。はんだ付けを行う箇所は画像の黄枠の部分です。(水色枠の部分のはんだ付けは任意です。)
![ロータリーエンコーダ用はんだ付け箇所](https://user-images.githubusercontent.com/54104281/147804958-0f9afd54-6870-4564-af59-4ebcd15293b7.jpg)

(β版の場合)画像の様に、ロータリーエンコーダの端子(特に端子が3本ある方)とトッププレートが干渉することがあります。
![IMG_20211231_114421](https://user-images.githubusercontent.com/54104281/147805201-d71d5d3c-9593-4917-ab5e-da8666b10da4.jpg)

その場合、トッププレートの干渉部分を削るか、ロータリーエンコーダの端子を下の画像の様に(半分より下を外側に広げるように)曲げて取付けます。
![IMG_20211231_114809](https://user-images.githubusercontent.com/54104281/147805239-43c1a04e-c385-49d7-8418-a9d8683d9750.jpg)

取付後の画像
![IMG_20211231_115656](https://user-images.githubusercontent.com/54104281/147805345-7c1e50f9-cc71-4174-a2e9-f4177c6a7ef3.jpg)

## キースイッチ基板、拡張基板の再取付

取外しとは逆の手順で、キースイッチ基板とProMicro基板を接続し、キースイッチ基板と拡張基板をボトムプレートへねじ止めします。

取付後、キースイッチ基板と拡張基板を接続しているジャンパピンの状態を確認します。ピンヘッダとの接続が甘くなっていたり、外れている場合は取付け直します。

## (QMK Toolboxを使用する場合)ロータリーエンコーダ対応のファームウェアの書込み
キーボード組立時に行った
[入力動作テスト](https://github.com/N2-Sumikko/HalfCliff/blob/master/doc/Oparation_test_jp.md)
の内容を参考に、QMK ToolboxにてHexファイルを書込みます。

現時点で使用可能なロータリーエンコーダ対応のHexファイルは以下の通りです。いずれもロータリーエンコーダの機能はVIA、Remapにて変更可能です。

QMKにマージされたファームウェアを変更して作成したものは(unofficial)と記載しています。いずれも動作確認済です。(もし動作に問題があった場合はご連絡いただけると助かります。)

|フォルダ|ファイル名|概要|
|:-|:-|:-|
|hex/qmk_0.15.4/via/others/(unofficial)oled_encoder_trackball_mousekey/|halfcliff_via.hex|OLEDとロータリーエンコーダとトラックボール使用時です。|
|hex/qmk_0.15.4/via/others/(unofficial)encoder_trackball_mousekey/|halfcliff_via.hex|トラックボールとロータリーエンコーダ使用時です。|
|hex/qmk_0.15.4/via/others/(unofficial)oled_encoder/|halfcliff_via.hex|OLED、ロータリーエンコーダ使用時用です。|
|hex/qmk_0.15.4/via/others/(unofficial)encoder/|halfcliff_via.hex|ロータリーエンコーダ使用時用です。|

## (QMK MSYSを使用する場合)ロータリーエンコーダ対応のファームウェアの書込み
必要に応じて追記する予定です。

# ビットトレードワン製トラックボール(ADTB7M)
のぎけす屋様のトラックボールモジュール用レベル変換基板の使用により、ビットトレードワン製トラックボール(ADTB7M)が使用可能です。

## 必要な部品の用意
以下の部品を用意します。(トラックボールモジュール取付用キットが用意出来ていないので、現時点では参考程度の情報となります。)
|名前|合計数|備考|
|:-|:-|:-|
|7mmオプティカルトラックボールモジュール１uタイプ|1個|[ビット・トレード・ワン様のトラックボールモジュール(型番：ADTB7M)](https://bit-trade-one.co.jp/selfmadekb/adtb7m/)です。以下、トラックボールモジュールと呼びます。|
|トラックボールモジュール用レベル変換基板|1個|のぎけす屋様のトラックボールモジュール用レベル変換基板です。以下、変換基板と呼びます。|
|トラックボールモジュール用トッププレート|1個|トラックボールモジュール取付用キットに同梱の部品です。|
|トラックボールモジュール用ボトムプレート|1個|トラックボールモジュール取付用キットに同梱の部品です。|
|M2x6mmスペーサー|2本|トラックボールモジュール取付用キットに同梱の部品です。|
|M2x4mmスペーサー|2本|トラックボールモジュール取付用キットに同梱の部品です。|
|M2x10mmねじ|2本|トラックボールモジュール取付用キットに同梱の部品です。|
|M2x4mmねじ|2本|トラックボールモジュール取付用キットに同梱の部品です。|

トラックボールモジュール、変換基板は遊舎工房様の実店舗、[通販サイト](https://yushakobo.jp/shop/)等で購入可能です。

トラックボールモジュール取付用キットは用意出来次第、何らかの形で販売する予定です。

## 使用時の主な注意点
* キーボード組立時にキースイッチ基板にロープロファイルピンソケット1x4をはんだ付けしていない場合、トラックボールモジュールの取付は基本的に不可です。ご注意ください。
　(完全に不可能ではありませんが、とても長いピンヘッダを使用するなど、特殊な取付方法が必要です。試したら追記します。）
* halfcliffにてトラックボールを使用する場合、基本のファームウェア(本資料に記載のファームウェア)ではトラックボールを左キーボードに取付けた時のみ正しく動作します。右キーボードにトラックボールを取付けたい場合は、右キーボードにUSBケーブルを接続した時に正しく動作するファームウェアの書込みが必要です。(具体的には、config.hに#define MASTER_RIGHTを追記してコンパイルしたファームウェア等)
* トラックボールモジュールの配線及びピンヘッダを変換基板にはんだ付けする際は、各部品の向きにご注意ください。
* アクリル製の部品にスペーサーの取付けやねじ止めをする際は、強い力をかけると破損の恐れがあるのでご注意ください。

## 取付け方法

おおまかな作業順序
* (キースイッチはんだ付け済みの場合)トラックボールモジュール取付箇所のキースイッチの取外し
* 変換基板へのトラックボールモジュール配線、ピンヘッダ1x4のはんだ付け
* トラックボールモジュール用ボトムプレートの穴へ変換基板の配線を通す
* トッププレートにM2x4㎜スペーサー2つをM2x10mmねじ2本で取付け
* キースイッチ基板のロープロファイルピンソケット1x4へ変換基板のピンヘッダ1x4を取付け
* M2x10mmねじへトラックボールモジュール用ボトムプレートの穴を通す
* M2x6mmスペーサ2つをM2x10mmねじにねじ止めしてトラックボール用ボトムプレートを固定
* トラックボールモジュールの配線位置を調整して、トラックボールモジュール用ボトムプレートの上にトラックボールモジュールを置けるようにする
* トラックボールモジュール用トッププレートをM2x4mmねじ2本で固定
* (QMK Toolboxを使用する場合)トラックボールモジュール対応のHexファイルの書込み
* (QMK MSYSを使用する場合。ちょっと大変)トラックボールモジュール対応のファームウェアの書込み

トラックボールモジュール対応のファームウェアの内容に関しては、[こちら](https://github.com/sekigon-gonnoc/qmk_firmware/tree/dev/ble_micro_pro/keyboards/helix/rev2/keymaps/bto_tb)のせきごん様のリンクも参考になるかと思います。

## (キースイッチはんだ付け済みの場合)トラックボールモジュール取付箇所のキースイッチの取外し

トラックボール取付箇所(左右共に、一番内側の、一番上のキーの位置)

にキースイッチがある場合は(はんだを除去して)取外します。ない場合はこの手順は飛ばします。

まずは取付を行うキーボードを裏返し、キースイッチ基板、拡張基板をボトムプレートに固定しているねじを取外します。

左キーボードのねじ取外し箇所(黄丸で示したねじを取外します。)
![ねじ取外し_ロータリーエンコーダ取付時](https://user-images.githubusercontent.com/54104281/147803209-2badeb80-8cf0-4f1e-b8aa-3da6823bc07c.jpg)

ねじを取外したら、キースイッチ基板と拡張基板をProMicro基板の反対方向にスライドさせて取外します。この時、ProMicro基板とキースイッチ基板を接続しているピンになるべく負荷をかけないよう注意します。

左キーボードの取外しのイメージ(水色の矢印の向きにスライドさせます。)

![キースイッチ基板取外し_ロータリーエンコーダ取付時](https://user-images.githubusercontent.com/54104281/147803508-5d07b866-d666-4027-957a-6e8e78c8a807.jpg)

取外し後、トラックボールモジュール取付箇所のキースイッチのはんだをはんだ吸取機等で取り除き、取外します。

左キーボードでの取外し箇所(黄丸の部分のはんだを除去し、キースイッチを取外します。)

![トラックボール取付時のキースイッチ取外し箇所](https://user-images.githubusercontent.com/54104281/147865254-d339629d-2fd9-4b61-a3b8-4ae9cbc31fa6.jpg)


## 変換基板へのトラックボールモジュール配線、ピンヘッダ1x4のはんだ付け

画像のように、変換基板へトラックボールモジュールの配線と、ピンヘッダ1x4をはんだ付けします。各部品の向きに注意して下さい。

言葉で説明すると、トラックボールモジュールの配線がある面を自分の方に向けて、変換基板の部品がある面を下、かつ部品が無い面の文字を自分から見て正しい向きにした状態で、部品が無い面からある面へ配線を通します。

その後、部品がある面の長方形のパッドにそれぞれの配線をはんだ付けします。

ピンヘッダ1x4については、ピンヘッダの短い方が変換基板側、かつピンヘッダの樹脂部分が変換基板の部品がある面に来るようにして、四角形のランドにピンが入るように取付けてはんだ付けします。(四角形のランドから一番遠い、丸いランドにはピンヘッダが来ないようにします。)

![IMG_20211231_115737](https://user-images.githubusercontent.com/54104281/147865297-b79851ec-08da-475a-9446-2f6b6e2ec99f.jpg)

変換基板を裏返した写真(長方形のパッドへのはんだ付け参考用)
![IMG_20211231_115751](https://user-images.githubusercontent.com/54104281/147865464-faa21119-564d-425d-b3fb-cfcbe405e169.jpg)

## トラックボールモジュール用ボトムプレートの穴へ変換基板の配線を通す

トラックボールモジュール用ボトムプレートの保護シートがある場合ははがします。

その後画像の様に、トラックボールモジュール用ボトムプレートの穴へ、トラックボールモジュールの配線を通します。

![IMG_20211231_115819](https://user-images.githubusercontent.com/54104281/147865483-5b4d7f89-a75e-4778-b0e1-363721fbad8f.jpg)

## トッププレートにM2x4㎜スペーサー2つをM2x10mmねじ2本で取付け

画像の様に、トッププレートのU字の切り欠き2箇所に、M2x10mmねじ2本でM2x4㎜スペーサー2つを取付けます。

(説明のため、左キーボードのProMicroカバーや一部のキーキャップを取外してあります。)

![IMG_20211231_120054](https://user-images.githubusercontent.com/54104281/147865631-08b4c85d-45a2-45e0-a6f7-96166fbead41.jpg)

## キースイッチ基板のロープロファイルピンソケット1x4へ変換基板のピンヘッダ1x4を取付け

画像の様に、キースイッチ基板のロープロファイルピンソケット1x4に、キースイッチ基板のトッププレートを介して変換基板のピンヘッダ1x4を取付けます。

![IMG_20211231_120134](https://user-images.githubusercontent.com/54104281/147865642-2da5ce9a-ed5a-4326-b632-12dbd91495d4.jpg)

## M2x10mmねじへトラックボールモジュール用ボトムプレートの穴を通す

画像の様に、トラックボールモジュール用ボトムプレートの穴にM2x10mmねじ2本を通します。

![IMG_20211231_120155](https://user-images.githubusercontent.com/54104281/147865657-e1efcedc-9015-473e-b925-192185e8914f.jpg)

## M2x6mmスペーサ2つをM2x10mmねじにねじ止めしてトラックボール用ボトムプレートを固定

M2x10mmねじ2本にM2x6㎜スペーサー2つをトラックボールモジュール用ボトムプレートの上から取付け、トラックボールモジュール用ボトムプレートを固定します。

![IMG_20211231_120557](https://user-images.githubusercontent.com/54104281/147865698-efa2ceec-5e1c-4a56-aecc-5aebc226503a.jpg)

## トラックボールモジュールの配線位置を調整して、トラックボールモジュール用ボトムプレートの上にトラックボールモジュールを置けるようにする

画像を参考にトラックボールモジュールの配線位置を調整して、ボトムプレートの上にトラックボールモジュールを置けるようにします。
![IMG_20211231_120332](https://user-images.githubusercontent.com/54104281/147865684-efcc6395-6c72-48b3-ab6a-759d730ce540.jpg)

## トラックボールモジュール用トッププレートをM2x4mmねじ2本で固定

トラックボールモジュールの位置を調整しながら、M2x6mmスペーサ2つにトラックボールモジュール用トッププレートをM2x4mmねじ2本でねじ止めします。

![IMG_20211231_120655](https://user-images.githubusercontent.com/54104281/147865706-7704bf9e-548d-4017-83ac-65e934809677.jpg)

## (QMK Toolboxを使用する場合)トラックボールモジュール対応のHexファイルの書込み

キーボード組立時に行った
[入力動作テスト](https://github.com/N2-Sumikko/HalfCliff/blob/master/doc/Oparation_test_jp.md)
の内容を参考に、QMK ToolboxにてHexファイルを書込みます。

現時点で使用可能なトラックボール対応のHexファイルは以下の通りです。

QMKにマージされたファームウェアを変更して作成したものは(unofficial)と記載しています。いずれも動作確認済です。

|フォルダ|ファイル名|概要|
|:-|:-|:-|
|hex/qmk_0.15.4/via/others/(unofficial)oled_encoder_trackball_mousekey/|halfcliff_via.hex|OLEDとロータリーエンコーダとトラックボール使用時です。エンコーダの機能はVIA、Remapにて変更可能です。|
|hex/qmk_0.15.4/via/others/(unofficial)encoder_trackball_mousekey/|halfcliff_via.hex|ロータリーエンコーダとトラックボール使用時です。エンコーダの機能はVIA、Remapにて変更可能です。|
|hex/qmk_0.15.4/via/others/(unofficial)trackball_mousekey/|halfcliff_via.hex|トラックボール使用時用です。|

## (QMK MSYSを使用する場合。ちょっと大変)トラックボールモジュール対応のファームウェアの作成、書込み
必要に応じて追記する予定です。(作成のパターンは、ファイルの直接変更か差替えの2パターンがあると考えています。追記する場合は、まずはファイルの差替えの手順を書く予定です。)

# OLED
対応するOLEDの取付が可能です。以下編集中の情報です。

## 必要な部品の用意
以下の部品を用意します。
|名前|合計数|備考|
|:-|:-|:-|
|OLED|2個|[こちら](https://shop.yushakobo.jp/products/oled)、または互換品が使用可能です。ただし全体の厚みに注意です。|
|ピンヘッダ1x4|1個|ピンヘッダの長さに注意が必要です。**詳細を確認次第追記**|
|M2x2mm中空スペーサー|4個|halfcliffの基本セットに付属の予備のスペーサーが使用可能です。|
|M2x6mmねじ|4本||

## 使用時の主な注意点
* OLEDによっては、基板とディスプレイの間に厚い両面テープがあり、全体の厚みが増していることがあります。そのような場合、中空スペーサーを使用してもOLEDとProMicroカバーが干渉する可能性があります。対策としては、ディスプレイを割らないように気を付けながら両面テープをはがし、薄い両面テープを貼り直す等が有効です。
* OLEDを使用する場合、左右のキーボードにOLEDを取付ける必要があります。
* デフォルトの状態のOLEDにはレイヤーの状態とQMK firmwareのロゴが表示されます。表示内容を変更する場合、QMK MSYS等を使用してファームウェアを変更する必要があります。
* アクリル製の部品にスペーサーの取付けやねじ止めをする際は、強い力をかけると破損の恐れがあるのでご注意ください。

## 取付け方法

大まかな作業順序
* ProMicroカバーの取外し
* OLEDへピンヘッダ1x4のはんだ付け(注意点有り)
* ロープロファイルピンソケット1x4へのOLEDの取付け、はんだ付け
* M2x2㎜中空スペーサー、ProMicroカバーをM2x6mmねじで取付
* (QMK Toolboxを使用する場合)トラックボールモジュール対応のHexファイルの書込み
* (QMK MSYSを使用する場合)トラックボールモジュール対応のファームウェアの書込み

## ProMicroカバーの取外し
ProMicroカバーを固定しているM2x4mmねじ2本を緩め、ProMicroカバーを取外します。左右のキーボードに対して同様の作業を実施します。

## OLEDへピンヘッダ1x4の取付け、はんだ付け(注意点有り)

OLEDへピンヘッダ1x4を取付け、はんだ付けします。

(注意点)ProMicro基板のロープロファイルピンソケット1x4へOLEDのピンヘッダ1x4を取付ける際には、ある程度の高さが必要です。(具体的には、OLEDの基板底面から樹脂部分含めて9㎜程度の長さが必要です。[こちら](https://hirosugi.co.jp/products/N/PSH-41.html)等が使用可能です。

## ロープロファイルピンソケット1x4へのOLEDの取付け

ProMicro基板のロープロファイルピンソケット1x4へ、OLEDにはんだ付けしたピンヘッダ1x4を取付けます。

## M2x2㎜中空スペーサー、ProMicroカバーをM2x6mmねじで取付

ProMicro基板を固定していたM2x7mmスペーサー2つの上にM2x2mm中空スペーサーをそれぞれ置きます。
![IMG_20211231_122209](https://user-images.githubusercontent.com/54104281/148025007-66c807cd-e192-489e-a722-4329f85a8a0f.jpg)

その後、M2x6mmねじ2本を、ProMicroカバー、中空スペーサーの穴の順に通してM2x7mmスペーサーへねじ止めします。

![IMG_20211231_122407](https://user-images.githubusercontent.com/54104281/148026160-46d47b54-140d-4e15-84cc-434362097670.jpg)



## (QMK Toolboxを使用する場合)トラックボールモジュール対応のHexファイルの書込み
キーボード組立時に行った
[入力動作テスト](https://github.com/N2-Sumikko/HalfCliff/blob/master/doc/Oparation_test_jp.md)
の内容を参考に、QMK ToolboxにてHexファイルを書込みます。

現在使用可能なOLED対応のHexファイルは以下の通りです。

QMKにマージされたファームウェアを変更して作成したものは(unofficial)と記載しています。いずれも動作確認済です。

|フォルダ|ファイル名|概要|
|:-|:-|:-|
|hex/qmk_0.15.4/via/others/(unofficial)oled_encoder_trackball_mousekey/|halfcliff_via.hex|OLEDとロータリーエンコーダとトラックボール使用時です。エンコーダの機能はVIA、Remapにて変更可能です。|
|hex/qmk_0.15.4/via/others/(unofficial)oled_trackball_mousekey/|halfcliff_via.hex|OLED、トラックボール使用時です。|
|hex/qmk_0.15.4/via/others/(unofficial)oled_encoder/|halfcliff_via.hex|OLEDとロータリーエンコーダ使用時用です。エンコーダの機能はVIA、Remapにて変更可能です。|
|hex/qmk_0.15.4/via/others/(unofficial)oled/|halfcliff_via.hex|OLED使用時用です。|

## (QMK MSYSを使用する場合)トラックボールモジュール対応のファームウェアの書込み
必要に応じて追記する予定です。
